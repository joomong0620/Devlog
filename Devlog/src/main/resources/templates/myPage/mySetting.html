<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>DevLog - 프로필 설정</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <link rel="stylesheet" th:href="@{/css/common/common.css}">
    <link rel="stylesheet" th:href="@{/css/common/notification.css}" />

    <link rel="stylesheet" th:href="@{/css/myPage/mySetting.css}">
</head>

<body>

    <div th:replace="~{common/header :: header}"></div>
    
    <main class="settings-container">
        <div class="settings-inner">
            <aside class="settings-sidebar">
                <div class="profile-img-wrapper">
                    <div class="img-box">
                        <img th:src="${member.profileImg != null ? member.profileImg : '/images/member/user.png'}" 
                            id="profileDisplay" alt="프로필 이미지">
                        
                        <button class="gear-btn" onclick="document.getElementById('fileInput').click()">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                        <button class="delete-img-btn" id="deleteImgBtn" title="이미지 삭제">×</button>
                    </div>
                    <input type="file" id="fileInput" hidden accept="image/*">
                </div>

                <nav class="settings-menu">
                    <ul>
                        <li class="menu-item active" data-target="info-change">내 정보 변경</li>
                        <li class="menu-item" data-target="sub-setting">구독 설정</li>
                        <li class="menu-item" data-target="pw-change">비밀번호 변경</li>
                        <li class="menu-item" data-target="withdraw">회원 탈퇴</li>
                    </ul>
                </nav>
            </aside>

            <section class="settings-content">
                <div id="info-change" class="profile-section active">
                    <h2>내 정보 변경</h2>
                    <div class="input-group">
                        <label>닉네임</label>
                        <input type="text" id="memberNickname" th:value="${member.memberNickname}">
                    </div>
                    <div class="input-group">
                        <label>이름</label>
                        <input type="text" id="memberName" th:value="${member.memberName}" readonly style="background:#f5f5f5; color:#999;">
                    </div>
                    <div class="input-group">
                        <label>경력사항</label>
                        <input type="text" id="memberCareer" th:value="${member.memberCareer}" placeholder="예: 백엔드 3년차">
                    </div>
                    <div class="input-group">
                        <label>소개글</label>
                        <textarea id="myInfoIntro" rows="3" th:text="${member.myInfoIntro}" placeholder="자신을 소개해 주세요."></textarea>
                    </div>
                    <div class="input-group">
                        <label>전화번호</label>
                        <input type="text" id="memberTel" th:value="${member.memberTel}">
                    </div>
                    <div class="input-group">
                        <label>이메일</label>
                        <input type="email" th:value="${member.memberEmail}" readonly style="background:#f5f5f5; color:#999;">
                    </div>

                    <div class="social-info">
                        <div class="social-input">
                            <span><i class="fa-brands fa-github"></i> 깃허브 주소</span>
                            <input type="text" id="myInfoGit" th:value="${member.myInfoGit}" placeholder="https://github.com/">
                        </div>
                        <div class="social-input">
                            <span><i class="fa-solid fa-house"></i> 홈페이지 주소</span>
                            <input type="text" id="myInfoHomepage" th:value="${member.myInfoHomepage}" placeholder="https://blog.com/">
                        </div>
                    </div>
                    <div class="btn-area">
                        <button class="submit-btn" onclick="handleUpdate('info')">수정하기</button>
                    </div>
                </div>

                <div id="sub-setting" class="profile-section">
                    <h2>구독 설정</h2>
                    <div class="sub-badge">
                        <i class="fa-solid fa-crown"></i>
                        <span>유료 정기구독 전용</span>
                    </div>
                    <div class="input-group">
                        <label>구독 금액</label>
                        <div class="bean-input-wrapper">
                            <img th:src="@{/images/common/2bean.png}" class="bean-icon-img" alt="커피콩">
                            <input type="number" id="subscriptionPrice" th:value="${member.subscriptionPrice}"> <span class="unit">콩</span>
                        </div>
                    </div>
                    <div class="btn-area">
                        <button class="submit-btn" onclick="handleUpdate('sub')">적용하기</button>
                    </div>
                </div>

                <div id="pw-change" class="profile-section">
                    <h2>비밀번호 변경</h2>
                    <div class="input-group">
                        <label>현재 비밀번호</label>
                        <input type="password" id="currentPw" placeholder="현재 비밀번호 입력">
                    </div>
                    <div class="input-group">
                        <label>변경할 비밀번호</label>
                        <input type="password" id="newPw" placeholder="변경할 비밀번호 (영문,숫자,특수문자 6~20자)" autocomplete="new-password">
                        <p id="pwMsg" class="form-msg"></p>
                    </div>
                    <div class="input-group">
                        <label>변경할 비밀번호 확인</label>
                        <input type="password" id="newPwConfirm" placeholder="변경할 비밀번호 재입력" autocomplete="new-password">
                        <p id="pwConfirmMsg" class="form-msg"></p>
                    </div>
                    <div class="btn-area">
                        <button class="submit-btn" onclick="handleUpdate('pw')">수정하기</button>
                    </div>
                </div>

                <div id="withdraw" class="profile-section">
                    <h2>회원 탈퇴</h2>
                    <div class="terms-box">
                        <p>제1조 (회원탈퇴 신청)</p>
                        <p>1. 회원은 언제든지 서비스 내 '회원탈퇴' 기능을 통해 탈퇴를 신청할 수 있습니다.</p>
                        <p>2. 탈퇴 시 보유하신 포인트는 모두 소멸되며 복구가 불가능합니다.</p>
                        <p>3. 작성하신 게시물은 삭제되지 않을 수 있으니 미리 확인 바랍니다.</p>
                        <br>
                        <p style="color:red; font-weight:bold;">정말로 탈퇴하시겠습니까?</p>
                    </div>
                    <div class="check-group">
                        <input type="checkbox" id="agreeTerm">
                        <label for="agreeTerm">약관에 동의하십니까?</label>
                    </div>
                    <div class="input-group">
                        <label>비밀번호 확인</label>
                        <input type="password" id="withdrawPw" placeholder="비밀번호를 입력해 주세요">
                    </div>
                    <div class="btn-area">
                        <button class="withdraw-btn" onclick="handleWithdraw()">탈퇴하기</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div th:replace="~{common/footer :: footer}"></div>
    <script th:src="@{/js/notification/noti.js}"></script>
    <script th:src="@{/js/common/header.js}"></script>

    <script th:src="@{/js/myPage/mySetting.js}"></script>
    
    <script th:inline="javascript">
        const memberNo = [[${member.memberNo}]];
    </script>
</body>
</html>